{
  "admin": {
    "disabled": false,
    "listen": "0.0.0.0:2019"
  },
  "logging": {
    "logs": {
      "default": {
        "level": "INFO"
      }
    }
  },
  "storage": {
    "module": "file_system",
    "root": "/data"
  },
  "apps": {
    "http": {
      "servers": {
        "srv0": {
          "listen": [":80", ":443"],
          "routes": [
            {
              "match": [{ "path": ["/health"] }],
              "handle": [
                {
                  "handler": "static_response",
                  "status_code": 200,
                  "body": "ok"
                }
              ]
            },
            {
              "match": [{ "host": ["api.giraffecloud.xyz"] }],
              "handle": [
                {
                  "handler": "headers",
                  "response": {
                    "set": {
                      "Strict-Transport-Security": [
                        "max-age=31536000; includeSubDomains; preload"
                      ],
                      "X-Content-Type-Options": ["nosniff"]
                    },
                    "delete": ["Server"]
                  }
                },
                {
                  "handler": "reverse_proxy",
                  "transport": {
                    "protocol": "http"
                  },
                  "upstreams": [
                    {
                      "dial": "api:8080"
                    }
                  ],
                  "headers": {
                    "request": {
                      "add": {
                        "Host": ["{http.request.host}"],
                        "X-Real-IP": ["{http.request.remote.host}"],
                        "X-Forwarded-For": ["{http.request.remote.host}"],
                        "X-Forwarded-Proto": ["{http.request.scheme}"],
                        "Origin": ["{http.request.header.Origin}"],
                        "Referer": ["{http.request.header.Referer}"],
                        "Authorization": [
                          "{http.request.header.Authorization}"
                        ],
                        "Cookie": ["{http.request.header.Cookie}"]
                      }
                    }
                  }
                }
              ]
            },
            {
              "handle": [
                {
                  "handler": "static_response",
                  "status_code": 404,
                  "body": "Not Found"
                }
              ]
            }
          ],
          "automatic_https": {
            "disable": false,
            "skip": [],
            "skip_certificates": [],
            "disable_redirects": false
          },
          "logs": {
            "default_logger_name": "default"
          }
        },
        "tunnel": {
          "listen": [":4443"],
          "routes": [
            {
              "match": [{ "host": ["tunnel.giraffecloud.xyz"] }],
              "handle": [
                {
                  "handler": "reverse_proxy",
                  "upstreams": [
                    {
                      "dial": "api:4443"
                    }
                  ],
                  "headers": {
                    "request": {
                      "add": {
                        "X-Forwarded-For": ["{http.request.remote.host}"],
                        "X-Real-IP": ["{http.request.remote.host}"]
                      }
                    }
                  }
                }
              ]
            }
          ],
          "automatic_https": {
            "disable": false
          }
        }
      }
    },
    "tls": {
      "automation": {
        "policies": [
          {
            "subjects": ["giraffecloud.xyz", "*.giraffecloud.xyz"],
            "issuers": [
              {
                "module": "acme",
                "ca": "https://acme-v02.api.letsencrypt.org/directory"
              }
            ]
          }
        ]
      }
    }
  }
}
