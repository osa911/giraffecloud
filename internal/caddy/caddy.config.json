{
  "admin": {
    "disabled": false,
    "listen": "0.0.0.0:2019"
  },
  "logging": {
    "logs": {
      "default": {
        "level": "INFO"
      }
    }
  },
  "storage": {
    "module": "file_system",
    "root": "/data"
  },
  "apps": {
    "http": {
      "servers": {
        "srv0": {
          "listen": [":80", ":443"],
          "routes": [
            {
              "match": [{ "path": ["/health"] }],
              "handle": [
                {
                  "handler": "static_response",
                  "status_code": 200,
                  "body": "ok"
                }
              ]
            },
            {
              "match": [
                {
                  "path": [
                    "/.env*",
                    "/config*",
                    "/admin*",
                    "/debug*",
                    "/.git/*",
                    "/swagger*",
                    "/metrics*",
                    "/.well-known/security.txt",
                    "/server-status*",
                    "/server-info*"
                  ]
                }
              ],
              "handle": [
                {
                  "handler": "static_response",
                  "status_code": 404,
                  "body": "Not Found"
                }
              ]
            },
            {
              "match": [{ "host": ["api.giraffecloud.xyz"] }],
              "handle": [
                {
                  "handler": "headers",
                  "response": {
                    "set": {
                      "Strict-Transport-Security": ["max-age=31536000; includeSubDomains; preload"],
                      "X-Content-Type-Options": ["nosniff"],
                      "X-Frame-Options": ["DENY"],
                      "X-XSS-Protection": ["1; mode=block"],
                      "Content-Security-Policy": ["default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self'"],
                      "Referrer-Policy": ["strict-origin-when-cross-origin"],
                      "Permissions-Policy": ["geolocation=(), microphone=(), camera=()"]
                    },
                    "delete": ["Server", "X-Powered-By"]
                  }
                },
                {
                  "handler": "reverse_proxy",
                  "upstreams": [{"dial": "api:8080"}],
                  "headers": {
                    "request": {
                      "add": {
                        "Host": ["{http.request.host}"],
                        "X-Real-IP": ["{http.request.remote.host}"],
                        "X-Forwarded-For": ["{http.request.remote.host}"],
                        "X-Forwarded-Proto": ["{http.request.scheme}"]
                      }
                    }
                  }
                }
              ]
            },
            {
              "match": [{ "host": ["*"] }],
              "handle": [
                {
                  "handler": "reverse_proxy",
                  "upstreams": [{"dial": "api:8081"}],
                  "headers": {
                    "request": {
                      "set": {
                        "Host": ["{http.request.host}"],
                        "X-Real-IP": ["{http.request.remote.host}"],
                        "X-Forwarded-For": ["{http.request.remote.host}"],
                        "X-Forwarded-Proto": ["{http.request.scheme}"]
                      }
                    }
                  }
                }
              ],
              "terminal": true
            }
          ],
          "automatic_https": {
            "disable": false,
            "on_demand": true
          }
        }
      }
    },
    "tls": {
      "automation": {
        "on_demand": {
          "ask": "http://api:8080/api/v1/caddy/check-domain"
        },
        "policies": [
          {
            "subjects": ["giraffecloud.xyz", "*.giraffecloud.xyz"],
            "issuers": [
              {
                "module": "acme",
                "ca": "https://acme-v02.api.letsencrypt.org/directory"
              }
            ]
          }
        ]
      }
    }
  }
}
